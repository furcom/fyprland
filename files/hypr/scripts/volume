#!/bin/bash

# Get the current volume status
volume_info=$(wpctl get-volume @DEFAULT_SINK@)

# Extract the volume level and mute status
current_volume=$(echo "$volume_info" | awk '{print $2}')
is_muted=$(echo "$volume_info" | grep -o "\[MUTED\]")

# Check if the volume is 0 (fully muted)
if [[ "$current_volume" == "0.00" ]]; then
    pkill mako
    notify-send "󰸈 Muted"
    exit 0
fi

# If muted but not zero volume, indicate muted status
if [[ -n "$is_muted" ]]; then
    pkill mako
    notify-send "󰸈 Muted"
    exit 0
fi

# Calculate volume percentage
volume_percent=$(echo "$current_volume * 100" | bc)

# Format volume percentage as an integer
volume_percent=$(printf "%.0f" "$volume_percent")

# Notify based on volume percentage using bc for comparisons
if (( $(echo "$volume_percent > 66" | bc -l) )); then
    pkill mako
    notify-send "󰕾  $volume_percent%"
elif (( $(echo "$volume_percent > 33" | bc -l) )); then
    pkill mako
    notify-send "󰖀  $volume_percent%"
elif (( $(echo "$volume_percent > 0" | bc -l) )); then
    pkill mako
    notify-send "󰕿  $volume_percent%"
else
    echo "󰸈  Muted"
fi
